From 5cadf9cbf4d0872a879666ea594be356fad5897e Mon Sep 17 00:00:00 2001
From: DavidJClark <david@noticeabledesigns.com>
Date: Tue, 16 Apr 2013 11:03:54 -0400
Subject: [PATCH] Update due to SQL injection exploit

---
 core/common/PopUpNewsData.class.php  | 4 ++--
 core/modules/PopUpNews/PopUpNews.php | 4 ++++
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/core/common/PopUpNewsData.class.php b/core/common/PopUpNewsData.class.php
index 10d44d5..44d6f4a 100644
--- a/core/common/PopUpNewsData.class.php
+++ b/core/common/PopUpNewsData.class.php
@@ -15,14 +15,14 @@ public function popupnewsitem($id)
     {
         $query = 'SELECT *
                  FROM ' . TABLE_PREFIX .'news
-                 WHERE id=' . $id . ' ';
+                 WHERE id=' . DB::escape($id) . ' ';
 
         return DB::get_row($query);
     }
     
     public function get_news_list($howmany) {
         $sql = 'SELECT id, subject, body, postedby, UNIX_TIMESTAMP(postdate) AS postdate
-		FROM ' . TABLE_PREFIX .'news ORDER BY postdate DESC LIMIT '.$howmany;
+		FROM ' . TABLE_PREFIX .'news ORDER BY postdate DESC LIMIT '.DB::escape($howmany);
 
         return DB::get_results($sql);
     }
diff --git a/core/modules/PopUpNews/PopUpNews.php b/core/modules/PopUpNews/PopUpNews.php
index 99cb515..ccd0a00 100644
--- a/core/modules/PopUpNews/PopUpNews.php
+++ b/core/modules/PopUpNews/PopUpNews.php
@@ -13,6 +13,8 @@ class PopUpNews extends CodonModule
 {
     public function popupnewsitem($id) {
 
+                if(!is_numeric($id)){header('Location: '.url('/'));}
+        
                 $result = PopUpNewsData::popupnewsitem($id);
                 Template::Set('item', $result);
                 Template::Show('popupnews/popupnews_item.tpl');
@@ -21,6 +23,8 @@ public function popupnewsitem($id) {
 
     public function PopUpNewsList($howmany = 5)
     {
+        if(!is_numeric($id)){exit;}
+        
         $res = PopUpNewsData::get_news_list($howmany);
 
         if(!$res)
